<!DOCTYPE html>
<html>
    <head>
        <title>DirecTEL</title>

        <script type="text/javascript" charset="utf-8" src="phonegap-1.2.0.js"></script>
        <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
        <script type="text/javascript" charset="utf-8" src="js/index.js"></script>
        <link rel="stylesheet" type="text/css" href="css/index.css">
        <script type="text/javascript" charset="utf-8">
            var cities = false;
            var cats = false;
            var secs = '';
            var colors = [[0, 0, 0], [191, 27, 44], [236, 0, 140], [0, 173, 239], [249, 167, 43], [55, 171, 156], [0, 0, 0], [25, 105, 188], [128, 204, 40], [154, 3, 70], [106, 94, 80], [133, 83, 51], [130, 20, 124], [245, 122, 20], [237, 28, 36], [0, 0, 0], [29, 100, 52], [55, 171, 156]];
            // A button will call this function
            function changeCity() {
                localStorage.removeItem("userCity");
                $('#ciudades').css({'right': '0%'});
                $('#categorias').css({'right': '-100%'});
                $('#secciones').css({'right': '-100%'});
                $('#topbar').css({'top': -50});
                loadCity();
            }
            function setCity(city, cityname) {
                localStorage.userCity = city;
                localStorage.userCityName = cityname;
                $('#ciudades').css({'right': '100%'});
                $('#categorias').css({'right': '0%'});
                $('#secciones').css({'right': '-100%'});
                $('#topbar').css({'top': 0});
                loadCat();
            }
            function loadCity() {
                if (!cities) {
                    $.post('http://directel.mx/acciones/serviceCiudades', function(e) {
                        cities = true;
                        var obj = jQuery.parseJSON(e);
                        for (var i in obj) {
                            $('#ciudadCanvas').append('<div class="cityItem" data-city="' + obj[i].id + '">' + obj[i].nombre + '<div class="ballnext"></div></div>');
                        }
                        $('.cityItem').on('click', function() {
                            setCity($(this).attr('data-city'), $(this).text());
                        });
                    });
                }
            }
            function loadCat() {
                $('#city').html(localStorage.userCityName);
                if (!cats) {
                    $.post('http://directel.mx/acciones/serviceCategorias', function(e) {
                        cats = true;
                        var obj = jQuery.parseJSON(e);
                        for (var i in obj) {
                            $('#categoriasCanvas').append('<a href="#"><div class="catItem" data-id="' + obj[i].id + '" data-name="' + obj[i].nombre + '"><div style=" padding: 8px 12px; padding-top: 12px;"><img src="img/logo_' + obj[i].id + '.png">' + obj[i].nombre + '<div class="secc">' + obj[i].secciones + '</div><div class="ballnext"></div></div></div></a>');
                        }
                        $('.catItem').on('click', function() {
                            getcat($(this).find('.secc').text(), $(this).attr('data-id'), $(this).attr('data-name'));
                        });
                    });
                } else {
                    $('#ciudades').css({'right': '100%'});
                    $('#categorias').css({'right': '0%'});
                    $('#secciones').css({'right': '-100%'});
                    $('#resultados').css({'right': '-100%'});
                }
            }
            function getcat(sec, idcat, namecat) {
                $('#categorias').css({'right': '100%'});
                $('#secciones').css({'right': '0%'});
                $('#resultados').css({'right': '-100%'});
                secs = sec;
                secciones = sec.split('|');
                secciones.sort();
                $('#seccionHeader').css({'background': 'rgb(' + colors[idcat][0] + ',' + colors[idcat][1] + ',' + colors[idcat][2] + ')'})
                $('#seccionHeader').html('<button class="backBtn" onclick="loadCat()" style="float:left;"><div class="ballprev"></div>Volver</button><img style="float:right; margin-top:-21px;" src="img/logo_' + idcat + '.png">' + namecat);
                $('#seccionesCanvas').html('');
                for (var i in secciones) {
                    $.post('http://directel.mx/acciones/serviceSeccion', {
                        sec: secciones[i]
                    }, function(e) {
                        var obj = jQuery.parseJSON(e);
                        $('#seccionesCanvas').append('<a href="#"><div class="secItem" data-idcat="' + idcat + '" data-namecat="' + namecat + '" data-nombre="' + obj.nombre + '"><div style=" padding: 8px 12px; padding-top: 12px;">' + obj.nombre + '<div class="ballnext"></div></div></div></a>');
                    });
                }

            }
            function getanuncios(sec, idcat, namecat) {
                $('#categorias').css({'right': '100%'});
                $('#secciones').css({'right': '100%'});
                $('#resultados').css({'right': '0%'});
                $('#resultadosHeader').css({'background': 'rgb(' + colors[idcat][0] + ',' + colors[idcat][1] + ',' + colors[idcat][2] + ')'})
                $('#resultadosHeader').html('<button class="backBtn" onclick="getcat(\'' + secs + '\',\'' + idcat + '\',\'' + namecat + '\')" style="float:left;"><div class="ballprev"></div>Volver</button><img style="float:right; margin-top:-21px;" src="img/logo_' + idcat + '.png">' + namecat);
                $('#resultadosCanvas').html('');
                $.post('http://directel.mx/acciones/serviceAnuncios', {
                    sec: sec,
                    ciudad: localStorage.userCity
                }, function(e) {
                    var obj = jQuery.parseJSON(e);
                    for (var i in obj) {
                        $('#resultadosCanvas').append('<a><div class="resultItem" data-id="' + obj[i].id + '" data-idcat="' + idcat + '" data-namecat="' + namecat + '"><div style=" padding: 8px 12px; padding-top: 12px;">' + obj[i].nombre + '<div class="secc">' + obj[i].shortD + '</div><div class="ballnext"></div></div></div></a>');
                    }
                });
            }
            function getbanuncios() {
                $('#categorias').css({'right': '100%'});
                $('#secciones').css({'right': '100%'});
                $('#resultados').css({'right': '0%'});
                $('#anuncio').css({'right': '-100%'});
            }
            function getanuncio(sec, idcat, namecat) {
                $('#categorias').css({'right': '100%'});
                $('#secciones').css({'right': '100%'});
                $('#resultados').css({'right': '100%'});
                $('#anuncio').css({'right': '0%'});
                $('#anuncioHeader').css({'background': 'rgb(' + colors[idcat][0] + ',' + colors[idcat][1] + ',' + colors[idcat][2] + ')'})
                $('#anuncioHeader').html('<button class="backBtn" onclick="getbanuncios()" style="float:left;"><div class="ballprev"></div>Volver</button><img style="float:right; margin-top:-21px;" src="img/logo_' + idcat + '.png">' + namecat);
                $.post('http://directel.mx/acciones/serviceAnuncio', {
                    sec: sec
                }, function(e) {
                    var obj = jQuery.parseJSON(e);
                    coo=obj.coordenadas;
                    $('#anuncioCanvas').html('');
                    $('#anuncioCanvas').append('<img class="imagen" src="http://directel.mx/content/img/logos/' + obj.logo + '">');
                    $('#anuncioCanvas').append('<div class="nombre">' + obj.nombre + '</div>');
                    $('#anuncioCanvas').append('<div class="shortD">' + obj.descripcion + '</div>');
                    $('#anuncioCanvas').append('<div class="shortD">' + obj.horario + '</div>');
                    $('#anuncioCanvas').append('<div class="tit">Direcci&oacute;n</div>');
                    $('#anuncioCanvas').append('<div class="direccion">' + obj.calle + ' No.' + obj.numero + '<br>' + obj.colonia + ', C.P. ' + obj.cp + '</div>');
                    $('#anuncioCanvas').append('<a href="geo:' + coo.replace('(','').replace(')','') + '"><div class="www">mapa</div></a>');
                    $('#anuncioCanvas').append('<div class="telefono">' + obj.telefono + '</div>');
                    $('#anuncioCanvas').append('<div class="email">' + obj.email + '</div>');
                    $('#anuncioCanvas').append('<div class="www">' + obj.www + '</div>');

                });
            }
            $(function() {
                app.initialize();
                if (!localStorage.userCity) {
                    $('#ciudades').css({'right': '0%'});
                    loadCity();
                } else {
                    $('#topbar').css({'top': 0});
                    $('#ciudades').css({'right': '100%'});
                    $('#categorias').css({'right': '0%'});
                    loadCat();
                }
                $('#seccionesCanvas').on('click', '.secItem', function() {
                    getanuncios($(this).attr('data-nombre'), $(this).attr('data-idcat'), $(this).attr('data-namecat'));
                });

                $('#resultadosCanvas').on('click', '.resultItem', function() {
                    getanuncio($(this).attr('data-id'), $(this).attr('data-idcat'), $(this).attr('data-namecat'));
                });

            });
            /*http://appzventure.com/ios-7-concept-designs-future-iphone/*/

        </script>
    </head>
    <body style="background: url(img/bg.png); text-align: center;">
        <div id="contenedor">
            <div class="seccion" id="ciudades">
                <table style="width: 100%; height: 100%;"><tr><td>
                            <img style=" margin-top: 70px; max-width: 100%; width: 200px;" src="img/logo_directel.png">
                        </td></tr>
                    <tr><td><div id="ciudadCanvas"></div></td></tr>

                    <tr><td></td></tr>
                </table>
            </div>
            <div id="topbar">
                <img onclick="changeCity()" style="position: absolute; left: 10px; top: 10px; height: 30px;" src="img/ciudad.png">
                <img alt="Directel" style=" height: 40px; margin: 5px;" src="img/logo_directel.png">
                <div style="position: absolute; bottom: 3px; right: 10px; font-size: 11px" id="city"></div>
            </div>
            <div class="seccion" id="categorias">
                <table style="width: 100%; max-width: 100%; height: 100%;">
                    <tr><td>
                            <div id="categoriasCanvas" ></div>
                        </td></tr>
                </table>
            </div>
            <div class="seccion" id="secciones">
                <table style="width: 100%; max-width: 100%; height: 100%;">
                    <tr><td style="vertical-align: top; height: 60px;">
                            <div id="seccionHeader" style="height: 40px; width: 100%; color: #fff; padding-top: 22px; text-align: center; font-weight: bold; font-size: 16px;"></div>
                        </td></tr>
                    <tr><td style="vertical-align: top;">
                            <div id="seccionesCanvas" ></div>
                        </td></tr>
                </table>
            </div>
            <div class="seccion" id="resultados">
                <table style="width: 100%; max-width: 100%; height: 100%;">
                    <tr><td style="vertical-align: top; height: 60px;">
                            <div id="resultadosHeader" style="height: 40px; width: 100%; color: #fff; padding-top: 22px; text-align: center; font-weight: bold; font-size: 16px;"></div>
                        </td></tr>
                    <tr><td style="vertical-align: top;">
                            <div id="resultadosCanvas" ></div>
                        </td></tr>
                </table>
            </div>
            <div class="seccion" id="anuncio">
                <table style="width: 100%; max-width: 100%; height: 100%;">
                    <tr><td style="vertical-align: top; height: 60px;">
                            <div id="anuncioHeader" style="height: 40px; width: 100%; color: #fff; padding-top: 22px; text-align: center; font-weight: bold; font-size: 16px;"></div>
                        </td></tr>
                    <tr><td style="vertical-align: top;">
                            <div id="anuncioCanvas" >

                            </div>
                        </td></tr>
                </table>
            </div>
        </div>

    </body>
</html>